<channel version="4.5.2">
  <id>d7c717f8-bb6e-4ff4-8628-d87c6aaeb23d</id>
  <nextMetaDataId>2</nextMetaDataId>
  <name>0010 ORM v2026-01-17</name>
  <description></description>
  <revision>6</revision>
  <sourceConnector version="4.5.2">
    <metaDataId>0</metaDataId>
    <name>sourceConnector</name>
    <properties class="com.mirth.connect.connectors.vm.VmReceiverProperties" version="4.5.2">
      <pluginProperties/>
      <sourceConnectorProperties version="4.5.2">
        <responseVariable>None</responseVariable>
        <respondAfterProcessing>true</respondAfterProcessing>
        <processBatch>false</processBatch>
        <firstResponse>false</firstResponse>
        <processingThreads>1</processingThreads>
        <resourceIds class="linked-hash-map">
          <entry>
            <string>Default Resource</string>
            <string>[Default Resource]</string>
          </entry>
        </resourceIds>
        <queueBufferSize>1000</queueBufferSize>
      </sourceConnectorProperties>
    </properties>
    <transformer version="4.5.2">
      <elements>
        <com.mirth.connect.plugins.javascriptstep.JavaScriptStep version="4.5.2">
          <name>extrae segmento MSH</name>
          <sequenceNumber>0</sequenceNumber>
          <enabled>true</enabled>
          <script>var msh = {
	sendingApplication: msg[&apos;MSH&apos;][&apos;MSH.3&apos;][&apos;MSH.3.1&apos;].toString().trim(),
	sendingFacility: msg[&apos;MSH&apos;][&apos;MSH.4&apos;][&apos;MSH.4.1&apos;].toString().trim(),
	receivingApplication: msg[&apos;MSH&apos;][&apos;MSH.5&apos;][&apos;MSH.5.1&apos;].toString().trim(),
	receivingFacility: msg[&apos;MSH&apos;][&apos;MSH.6&apos;][&apos;MSH.6.1&apos;].toString().trim(),
	dateTimeOfMessage: msg[&apos;MSH&apos;][&apos;MSH.7&apos;][&apos;MSH.7.1&apos;].toString().trim()
};</script>
        </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
        <com.mirth.connect.plugins.javascriptstep.JavaScriptStep version="4.5.2">
          <name>extrae segmento PID</name>
          <sequenceNumber>1</sequenceNumber>
          <enabled>true</enabled>
          <script>var pid = {
	idNumber: msg[&apos;PID&apos;][&apos;PID.3&apos;][&apos;PID.3.1&apos;].toString().trim(),
	checkDigitScheme: msg[&apos;PID&apos;][&apos;PID.3&apos;][&apos;PID.3.4&apos;].toString().trim(),
	alternatePatientIdNumber: msg[&apos;PID&apos;][&apos;PID.4&apos;][&apos;PID.4.1&apos;].toString().trim(),
	alternatePatientIdType: msg[&apos;PID&apos;][&apos;PID.4&apos;][&apos;PID.4.4&apos;].toString().trim(),
	patientFamily: msg[&apos;PID&apos;][&apos;PID.5&apos;][&apos;PID.5.1&apos;].toString().trim(),
	patientGiven : msg[&apos;PID&apos;][&apos;PID.5&apos;][&apos;PID.5.2&apos;].toString().trim(),
	patientMothersName : msg[&apos;PID&apos;][&apos;PID.6&apos;][&apos;PID.6.1&apos;].toString().trim(),
	birthday : msg[&apos;PID&apos;][&apos;PID.7&apos;][&apos;PID.7.1&apos;].toString().trim(),
	sex : msg[&apos;PID&apos;][&apos;PID.8&apos;][&apos;PID.8.1&apos;].toString().trim(),
	addressStreet : msg[&apos;PID&apos;][&apos;PID.11&apos;][&apos;PID.11.1&apos;].toString().trim(),
	addressOtherDesignation : msg[&apos;PID&apos;][&apos;PID.11&apos;][&apos;PID.11.2&apos;].toString().trim(),
	addressCity : msg[&apos;PID&apos;][&apos;PID.11&apos;][&apos;PID.11.3&apos;].toString().trim(),
	addressState : msg[&apos;PID&apos;][&apos;PID.11&apos;][&apos;PID.11.4&apos;].toString().trim(),
	addressCountry : msg[&apos;PID&apos;][&apos;PID.11&apos;][&apos;PID.11.6&apos;].toString().trim(),
	addressCountryCode : msg[&apos;PID&apos;][&apos;PID.12&apos;][&apos;PID.12.1&apos;].toString().trim(),
	phoneNumberHome : msg[&apos;PID&apos;][&apos;PID.13&apos;][&apos;PID.13.1&apos;].toString().trim(),
	maritalStatus : msg[&apos;PID&apos;][&apos;PID.16&apos;][&apos;PID.16.1&apos;].toString().trim(),
	mail : msg[&apos;PID&apos;][&apos;PID.21&apos;][&apos;PID.21.1&apos;].toString().trim()
};</script>
        </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
        <com.mirth.connect.plugins.javascriptstep.JavaScriptStep version="4.5.2">
          <name>extrae segmento PV1</name>
          <sequenceNumber>2</sequenceNumber>
          <enabled>true</enabled>
          <script>var pv1 = {
	setId: msg[&apos;PV1&apos;][&apos;PV1.1&apos;].toString()
	};</script>
        </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
        <com.mirth.connect.plugins.javascriptstep.JavaScriptStep version="4.5.2">
          <name>extrae segmento ORC</name>
          <sequenceNumber>3</sequenceNumber>
          <enabled>true</enabled>
          <script>var orc = {};</script>
        </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
        <com.mirth.connect.plugins.javascriptstep.JavaScriptStep version="4.5.2">
          <name>extrae segmento OBR</name>
          <sequenceNumber>4</sequenceNumber>
          <enabled>true</enabled>
          <script>var obr = {
	setIdValue: msg[&apos;OBR&apos;][&apos;OBR.1&apos;][&apos;OBR.1.1&apos;].toString(),
	placeOrderField1: msg[&apos;OBR&apos;][&apos;OBR.2&apos;][&apos;OBR.2.1&apos;].toString(),
	universalServiceId_Identifier: msg[&apos;OBR&apos;][&apos;OBR.4&apos;][&apos;OBR.4.1&apos;].toString(),
	universalServiceId_Text: msg[&apos;OBR&apos;][&apos;OBR.4&apos;][&apos;OBR.4.2&apos;].toString(),
	priority: msg[&apos;OBR&apos;][&apos;OBR.5&apos;][&apos;OBR.5.1&apos;].toString()
	}</script>
        </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
        <com.mirth.connect.plugins.javascriptstep.JavaScriptStep version="4.5.2">
          <name>extrae segmento AIS</name>
          <sequenceNumber>5</sequenceNumber>
          <enabled>true</enabled>
          <script>var ais = {};</script>
        </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
        <com.mirth.connect.plugins.javascriptstep.JavaScriptStep version="4.5.2">
          <name>extrae segmento DG1</name>
          <sequenceNumber>6</sequenceNumber>
          <enabled>true</enabled>
          <script>var ddgg = [];

for each (dg in msg[&apos;DG1&apos;]) {
	//mapear
	dg = {
			diagnosis: msg[&apos;DG1&apos;][0][&apos;DG1.5&apos;][&apos;DG1.5.2&apos;].toString()
	}
	ddgg.push(dg);
}</script>
        </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
        <com.mirth.connect.plugins.javascriptstep.JavaScriptStep version="4.5.2">
          <name>ServiceRequest constructor</name>
          <sequenceNumber>7</sequenceNumber>
          <enabled>true</enabled>
          <script>var sourceObject = {
	status: &quot;hola&quot;
	};

var serviceRequest = new ServiceRequestResource(sourceObject)
  .setId(&quot;1&quot;)
  .setStatus(&quot;active&quot;)
  .setCategory(&quot;123&quot;,&quot;Consulta&quot;,&quot;http://category.cl&quot;)
  .setCode(&quot;456&quot;,&quot;Procedimiento&quot;,&quot;http://code.cl&quot;)
  .setSubject(&quot;Patient/123&quot;)
  .setEffectiveDateTime()
  .build();

logger.info(&quot;ServiceRequestJSON= &quot; + JSON.stringify(serviceRequest, null, 2));
channelMap.put(&quot;serviceRequest&quot;, serviceRequest);

//var sr3 = new ServiceRequestResource(obj2);

//sr3.setId(&quot;123&quot;);
//sr3.setStatus(&quot;kkkkk&quot;);

//logger.info(&quot;sr3=&quot; + JSON.stringify(sr3.build()));</script>
        </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
        <com.mirth.connect.plugins.javascriptstep.JavaScriptStep version="4.5.2">
          <name>Patient constructor</name>
          <sequenceNumber>8</sequenceNumber>
          <enabled>true</enabled>
          <script>var sourceObject = {
	active: true
	}

var patient = new PatientResource(sourceObject)
  .setId(&quot;123&quot;)
  .setActive(true)
  .addIdentifier(&quot;http://hospital.cl/mrn&quot;, &quot;MR&quot;, &quot;ABC-001&quot;)
  .addName(&quot;Pérez&quot;, [&quot;Juan&quot;], &quot;official&quot;)
  .setGender(&quot;male&quot;)
  .setBirthDate(&quot;1990-01-31&quot;)
  .addTelecom(&quot;phone&quot;, &quot;+56911112222&quot;, &quot;mobile&quot;, 1)
  .addAddress([&quot;Av. Siempre Viva 742&quot;], &quot;Santiago&quot;, &quot;RM&quot;, &quot;8320000&quot;, &quot;CL&quot;, &quot;home&quot;, &quot;both&quot;)
  .build();

logger.info(&quot;patientJSON=&quot; + JSON.stringify(patient, null, 2));
channelMap.put(&quot;patient&quot;, patient);</script>
        </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
        <com.mirth.connect.plugins.javascriptstep.JavaScriptStep version="4.5.2">
          <name>Condition constructor</name>
          <sequenceNumber>9</sequenceNumber>
          <enabled>true</enabled>
          <script>var sourceObject = {};

try {
	var condition = new ConditionResource(sourceObject)
	  .setId(&quot;cond-001&quot;)
	  .setClinicalStatus(&quot;active&quot;)
	  .setVerificationStatus(&quot;confirmed&quot;)
	  .setCategory(&quot;problem-list-item&quot;, &quot;Problem List&quot;)
	  .setCode(&quot;E11&quot;, &quot;Diabetes mellitus type 2&quot;, &quot;http://hl7.org/fhir/sid/icd-10&quot;)
	  .setSubject(&quot;Patient/123&quot;)
	  .setOnsetDate(&quot;2023-05-10&quot;)
	  .setRecorder(&quot;Practitioner/45&quot;)
	  .addNote(&quot;Paciente en control&quot;)
	  .build();
} 
catch (e) {
	logger.error(e);
}

logger.info(&quot;conditionJSON=&quot; + JSON.stringify(condition, null, 2));
channelMap.put(&quot;condition&quot;, condition);</script>
        </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
        <com.mirth.connect.plugins.javascriptstep.JavaScriptStep version="4.5.2">
          <name>Location constructor</name>
          <sequenceNumber>10</sequenceNumber>
          <enabled>true</enabled>
          <script>var sourceObject = {}

var location = new LocationResource(sourceObject)
  .setId(&quot;loc-1&quot;)
  .setStatus(&quot;active&quot;)
  .setName(&quot;Centro Médico ABC - Box 3&quot;)
  .setDescription(&quot;Box de medicina general&quot;)
  .setMode(&quot;instance&quot;)
  .setType(&quot;ro&quot;, &quot;Room&quot;, &quot;http://terminology.hl7.org/CodeSystem/location-physical-type&quot;) // o usa setPhysicalType
  .setPhysicalType(&quot;ro&quot;, &quot;Room&quot;, &quot;http://terminology.hl7.org/CodeSystem/location-physical-type&quot;)
  .setAddress([&quot;Av. Siempre Viva 742&quot;], &quot;Santiago&quot;, &quot;RM&quot;, &quot;8320000&quot;, &quot;CL&quot;)
  .setPosition(-33.4489, -70.6693, 560)
  .setManagingOrganization(&quot;Organization/1&quot;)
  .addTelecom(&quot;phone&quot;, &quot;+56 2 2345 6789&quot;, &quot;work&quot;, 1)
  .build();

logger.info(&quot;locationJSON=&quot; + JSON.stringify(location, null, 2));
channelMap.put(&quot;location&quot;, location);</script>
        </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
        <com.mirth.connect.plugins.javascriptstep.JavaScriptStep version="4.5.2">
          <name>Practitioner constructor</name>
          <sequenceNumber>11</sequenceNumber>
          <enabled>true</enabled>
          <script>var sourceObject = {};

var practitioner = new PractitionerResource(sourceObject)
  .setId(&quot;prac-1&quot;)
  .setActive(true)
  .addIdentifier(&quot;http://minsal.cl/rnpi&quot;, &quot;MD&quot;, &quot;123456&quot;)
  .addName(&quot;Pérez&quot;, [&quot;Ana&quot;, &quot;María&quot;], &quot;official&quot;, [&quot;Dra.&quot;])
  .setGender(&quot;female&quot;)
  .setBirthDate(&quot;1985-04-10&quot;)
  .addTelecom(&quot;phone&quot;, &quot;+56911112222&quot;, &quot;mobile&quot;, 1)
  .addAddress([&quot;Calle 123&quot;], &quot;Santiago&quot;, &quot;RM&quot;, &quot;8320000&quot;, &quot;CL&quot;, &quot;work&quot;, &quot;both&quot;)
  .addQualification(&quot;MD&quot;, &quot;Médico Cirujano&quot;, &quot;http://terminology.hl7.org/CodeSystem/v2-0360&quot;)
  .addCommunication(&quot;es&quot;, &quot;Spanish&quot;)
  .build();

logger.info(&quot;practitionerJson=&quot; + JSON.stringify(practitioner, null, 2));
channelMap.put(&quot;practitioner&quot;, practitioner);</script>
        </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
        <com.mirth.connect.plugins.javascriptstep.JavaScriptStep version="4.5.2">
          <name>AllergyIntolerance constructor</name>
          <sequenceNumber>12</sequenceNumber>
          <enabled>true</enabled>
          <script>var sourceObject = {};

var alg = new AllergyIntoleranceResource(sourceObject)
  .setId(&quot;alg-1&quot;)
  .setClinicalStatus(&quot;active&quot;)
  .setVerificationStatus(&quot;confirmed&quot;)
  .setType(&quot;allergy&quot;)
  .setCategory([&quot;medication&quot;])
  .setCriticality(&quot;high&quot;)
  .setCode(&quot;7982&quot;, &quot;Penicillin&quot;, &quot;http://snomed.info/sct&quot;)
  .setPatient(&quot;Patient/123&quot;)
  .setRecordedDate(&quot;2026-01-17T12:00:00-03:00&quot;)
  .addReaction(&quot;247472004&quot;, &quot;Hives&quot;, &quot;http://snomed.info/sct&quot;, &quot;moderate&quot;, &quot;Urticaria posterior a exposición&quot;)
  .addNote(&quot;Reportado por paciente&quot;)
  .build();

logger.info(&quot;allergyJson=&quot; + JSON.stringify(alg, null, 2));
channelMap.put(&quot;allergy&quot;, alg);</script>
        </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
        <com.mirth.connect.plugins.javascriptstep.JavaScriptStep version="4.5.2">
          <name>Bundle constructor</name>
          <sequenceNumber>13</sequenceNumber>
          <enabled>true</enabled>
          <script>var bundle = new BundleResource()
  //.setTimestamp(DateUtil.formatDate(new Date(), &quot;yyyy-MM-dd&apos;T&apos;HH:mm:ssXXX&quot;))
  .setTimestamp(&apos;2026-01-17&apos;)
  .addUpdate($(&apos;serviceRequest&apos;))
  .addUpdate($(&apos;patient&apos;)) // PUT Patient/123
  .addUpdate($(&apos;condition&apos;))    // PUT Condition/cond-001
  .addUpdate($(&apos;location&apos;))     // PUT Location/loc-1
  .addUpdate($(&apos;practitioner&apos;))
  .addUpdate($(&apos;allergy&apos;))
  .build();

logger.info(&quot;bundleJson=&quot; + JSON.stringify(bundle, null, 2));
channelMap.put(&quot;bundleJson&quot;, JSON.stringify(bundle));</script>
        </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
      </elements>
      <inboundTemplate encoding="base64">TVNIfF5+XCZ8SElTX0NCU1R8SElTX0NCU1RfSU5URVJGQUNFfENTSF9SSVN8Q1NIX1JJU19JTlRFUkZBQ0V8MjAxMzA3MDExODU1NTV8fE9STV5PMDF8fER8Mi4xfHxBTHxORXx8fApQSUR8fHwwMDExMDM1ODE1Xl5eQ0JTVH44OTg5NjI1LTheXl5SVVR8ODk4OTYyNS04Xl5eUlVUfE9WQU5ETyBGSUdVRVJPQV5KQUNRVUVMSU5FIEhBWURFRXx8MTk2MzEyMTd8Rnx8fExPUyBKQUNJTlRPUyA5NjJeQlVJTl5TQU5USVNHT14xM15eQ2hpbGV8Q2hpbGV8OTkzMzAzMjc4fHx8fHx8fHxqb2YubG9sZWtAZ21haWwuY29tfHx8fHxDTHx8ClBWMXx8T3xeXnx8fHw4NDUyODc1LTdeWlXDkUlHQSBSQU1JUkVaXkxPUkVOQSBERUwgQ0FSTUVOfHx8SUJBfHx8fHwwMDF8fHx8MDA0NTQ0NTYwMXwwMDQ1NDQ1NjAxfHx8fHx8fHx8fHx8fHx8fHx8fHx8fHwyMDI2MDExMwpPUkN8Tld8MDA0NTQ0NTYwMV5JQ1BUQlJPTnx8XlRFTEUgQlJPTkNPUFVMTU9OQVIgQURVTFRPfHx8Xl5eXjAwMXxMWlVOSUdBfHw4NDUyODc1LTdeWlXDkUlHQSBSQU1JUkVaXkxPUkVOQSBERUwgQ0FSTUVOXjg0NTI4NzUtN3x8fHx8MjAyNjAxMTMxMjE0NDJ8fElCQU1FRkFNXnx8fHwKT0JSfDA2NzE2MjgzOTV8SUNQUlBWQzF8fFI0MDMwMTRBUDFeVEMgREUgQUJET01FTiBZIFBFTFZJUyBDT04gQ09OVFJBU1RFIF58MjAyNi8wMS8xM3wKQUlTfHx8fHx8fHx8Xnx8CkRHMXx8ICB8MDAwMDAwMDAwMDAwMDB8fHF1aXJ1cmdpY29eIGFwZW5kaWNlY3RvbWlhLCBjZXNhcmVhfF58fHx8fHx8CkRHMXx8ICB8MDAwMDAwMDAwMDAwMDB8fG5vcXVpcnVyZ2leIFJHRT8sIGJydWNjaXNtb3xefHx8fHx8fApERzF8fCAgfDAwMDAwMDAwMDAwMDAwfHxxdWlydXJnaWNvXiBISVNURVJFQ1RPTcONQSBwb3IgTUlPTUFTVE9TSVMgZWwgIDIwMTN8Xnx8fHx8fHwKREcxfHwgIHwwMDAwMDAwMDAwMDAwMHx8cXVpcnVyZ2ljb14gQ0lSVUfDjUEgUkVGUkFDVElWQSBPRC4gKy8tIEVMIDIwMDYufF58fHx8fHx8CkRHMXx8ICB8MDAwMDAwMDAwMDAwMDB8fHJlZmxleGFuXnxefHx8fHx8fApERzF8fCAgfDAwMDAwMDAwMDAwMDAwfHxUYWJhcXVpc21vIG5vXnxefHx8fHx8fA==</inboundTemplate>
      <outboundTemplate encoding="base64"></outboundTemplate>
      <inboundDataType>HL7V2</inboundDataType>
      <outboundDataType>JSON</outboundDataType>
      <inboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="4.5.2">
        <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="4.5.2">
          <handleRepetitions>true</handleRepetitions>
          <handleSubcomponents>true</handleSubcomponents>
          <useStrictParser>false</useStrictParser>
          <useStrictValidation>false</useStrictValidation>
          <stripNamespaces>false</stripNamespaces>
          <segmentDelimiter>\r</segmentDelimiter>
          <convertLineBreaks>true</convertLineBreaks>
        </serializationProperties>
        <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="4.5.2">
          <useStrictParser>false</useStrictParser>
          <useStrictValidation>false</useStrictValidation>
          <segmentDelimiter>\r</segmentDelimiter>
        </deserializationProperties>
        <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="4.5.2">
          <splitType>MSH_Segment</splitType>
          <batchScript></batchScript>
        </batchProperties>
        <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="4.5.2">
          <segmentDelimiter>\r</segmentDelimiter>
          <successfulACKCode>AA</successfulACKCode>
          <successfulACKMessage></successfulACKMessage>
          <errorACKCode>AE</errorACKCode>
          <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
          <rejectedACKCode>AR</rejectedACKCode>
          <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
          <msh15ACKAccept>false</msh15ACKAccept>
          <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
        </responseGenerationProperties>
        <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="4.5.2">
          <successfulACKCode>AA,CA</successfulACKCode>
          <errorACKCode>AE,CE</errorACKCode>
          <rejectedACKCode>AR,CR</rejectedACKCode>
          <validateMessageControlId>true</validateMessageControlId>
          <originalMessageControlId>Destination_Encoded</originalMessageControlId>
          <originalIdMapVariable></originalIdMapVariable>
        </responseValidationProperties>
      </inboundProperties>
      <outboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="4.5.2">
        <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="4.5.2">
          <splitType>JavaScript</splitType>
          <batchScript></batchScript>
        </batchProperties>
      </outboundProperties>
    </transformer>
    <filter version="4.5.2">
      <elements/>
    </filter>
    <transportName>Channel Reader</transportName>
    <mode>SOURCE</mode>
    <enabled>true</enabled>
    <waitForPrevious>true</waitForPrevious>
  </sourceConnector>
  <destinationConnectors>
    <connector version="4.5.2">
      <metaDataId>1</metaDataId>
      <name>Destination 1</name>
      <properties class="com.mirth.connect.connectors.js.JavaScriptDispatcherProperties" version="4.5.2">
        <pluginProperties/>
        <destinationConnectorProperties version="4.5.2">
          <queueEnabled>false</queueEnabled>
          <sendFirst>false</sendFirst>
          <retryIntervalMillis>10000</retryIntervalMillis>
          <regenerateTemplate>false</regenerateTemplate>
          <retryCount>0</retryCount>
          <rotate>false</rotate>
          <includeFilterTransformer>false</includeFilterTransformer>
          <threadCount>1</threadCount>
          <threadAssignmentVariable></threadAssignmentVariable>
          <validateResponse>false</validateResponse>
          <resourceIds class="linked-hash-map">
            <entry>
              <string>Default Resource</string>
              <string>[Default Resource]</string>
            </entry>
          </resourceIds>
          <queueBufferSize>1000</queueBufferSize>
          <reattachAttachments>true</reattachAttachments>
        </destinationConnectorProperties>
        <script>//logger.info(connectorMessage.getEncodedData());</script>
      </properties>
      <transformer version="4.5.2">
        <elements/>
        <inboundDataType>JSON</inboundDataType>
        <outboundDataType>JSON</outboundDataType>
        <inboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="4.5.2">
          <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="4.5.2">
            <splitType>JavaScript</splitType>
            <batchScript></batchScript>
          </batchProperties>
        </inboundProperties>
        <outboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="4.5.2">
          <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="4.5.2">
            <splitType>JavaScript</splitType>
            <batchScript></batchScript>
          </batchProperties>
        </outboundProperties>
      </transformer>
      <responseTransformer version="4.5.2">
        <elements/>
        <inboundDataType>JSON</inboundDataType>
        <outboundDataType>JSON</outboundDataType>
        <inboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="4.5.2">
          <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="4.5.2">
            <splitType>JavaScript</splitType>
            <batchScript></batchScript>
          </batchProperties>
        </inboundProperties>
        <outboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="4.5.2">
          <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="4.5.2">
            <splitType>JavaScript</splitType>
            <batchScript></batchScript>
          </batchProperties>
        </outboundProperties>
      </responseTransformer>
      <filter version="4.5.2">
        <elements/>
      </filter>
      <transportName>JavaScript Writer</transportName>
      <mode>DESTINATION</mode>
      <enabled>true</enabled>
      <waitForPrevious>true</waitForPrevious>
    </connector>
  </destinationConnectors>
  <preprocessingScript>// Modify the message variable below to pre process data
return message;</preprocessingScript>
  <postprocessingScript>// This script executes once after a message has been processed
// Responses returned from here will be stored as &quot;Postprocessor&quot; in the response map
return;</postprocessingScript>
  <deployScript>// This script executes once when the channel is deployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</deployScript>
  <undeployScript>// This script executes once when the channel is undeployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</undeployScript>
  <properties version="4.5.2">
    <clearGlobalChannelMap>true</clearGlobalChannelMap>
    <messageStorageMode>DEVELOPMENT</messageStorageMode>
    <encryptData>false</encryptData>
    <encryptAttachments>false</encryptAttachments>
    <encryptCustomMetaData>false</encryptCustomMetaData>
    <removeContentOnCompletion>false</removeContentOnCompletion>
    <removeOnlyFilteredOnCompletion>false</removeOnlyFilteredOnCompletion>
    <removeAttachmentsOnCompletion>false</removeAttachmentsOnCompletion>
    <initialState>STARTED</initialState>
    <storeAttachments>false</storeAttachments>
    <metaDataColumns/>
    <attachmentProperties version="4.5.2">
      <type>None</type>
      <properties/>
    </attachmentProperties>
    <resourceIds class="linked-hash-map">
      <entry>
        <string>Default Resource</string>
        <string>[Default Resource]</string>
      </entry>
    </resourceIds>
  </properties>
  <exportData>
    <metadata>
      <enabled>true</enabled>
      <lastModified>
        <time>1768755129037</time>
        <timezone>America/Santiago</timezone>
      </lastModified>
      <pruningSettings>
        <pruneMetaDataDays>1</pruneMetaDataDays>
        <pruneContentDays>1</pruneContentDays>
        <archiveEnabled>true</archiveEnabled>
        <pruneErroredMessages>false</pruneErroredMessages>
      </pruningSettings>
      <userId>1</userId>
    </metadata>
    <codeTemplateLibraries>
      <codeTemplateLibrary version="4.5.2">
        <id>4bb58b24-a479-4fe3-8288-59c881f24d7e</id>
        <name>CENS-FHIR LIBRARY FOR PHILLIPS-BUPA</name>
        <revision>13</revision>
        <lastModified>
          <time>1768778735746</time>
          <timezone>Etc/UTC</timezone>
        </lastModified>
        <description></description>
        <includeNewChannels>false</includeNewChannels>
        <enabledChannelIds>
          <string>d7c717f8-bb6e-4ff4-8628-d87c6aaeb23d</string>
          <string>9f14bb6b-421d-4b2b-a36e-be77b3fa999d</string>
        </enabledChannelIds>
        <disabledChannelIds>
          <string>e915c676-824e-45f6-b4a3-f4979c355266</string>
          <string>5ca5539b-e892-4be6-a2d8-90ca323bd90c</string>
          <string>ab4e805c-b106-4c52-9ec8-2b55f4f0e10a</string>
          <string>0a24f6d4-6832-49b2-b70c-225e9451a1ae</string>
          <string>ba6cb940-817f-41e8-8fd7-849a8833b9c9</string>
          <string>ddd4fb6b-0232-4af2-b32d-9022674322a0</string>
          <string>77506ca5-171e-4573-bde0-55f8d6e45c25</string>
          <string>0a8f6138-93eb-4e2e-9bc5-cf0daa7c3dcb</string>
          <string>4ce3cb61-5563-4e93-ac58-628dc5b9fc89</string>
          <string>17a2d374-8791-4075-a6d6-c07c74ea9024</string>
          <string>6748bfe4-cb40-469a-bee3-b30128c7fb88</string>
          <string>6ae7b2c6-fcc0-4399-bbd7-e516d596ade6</string>
          <string>713196e0-52ab-4f9a-9101-afa89bca152e</string>
          <string>2de13d52-355c-481a-bd2f-9c43d7ff7d0c</string>
          <string>8f47fbaf-5fb3-4143-99fa-c5088748053c</string>
          <string>f5066aba-9341-4927-a952-451a197b076c</string>
          <string>0a203b7b-2817-4246-95e6-225b4f062d13</string>
          <string>62499f89-9b58-4c3f-9f7a-92e7a031826c</string>
          <string>3316a31f-b6cb-48bd-887d-7e27105f7e4a</string>
          <string>9490c690-7b56-4d54-b7da-1bc609d4cb69</string>
          <string>7634f73d-cf74-4d92-9d7e-c93022f28832</string>
          <string>2f25ad07-5cea-4cbd-8a01-7c48fe6d50a4</string>
          <string>f4fbb43c-34d0-48d0-ae50-029d392fddf0</string>
          <string>fdf99305-f331-498a-af50-adfe60af87f7</string>
          <string>0dedc17b-077c-487a-9f7c-2ace8cdb02be</string>
          <string>e610d5a0-33a1-4da0-ac05-d0597733e3bb</string>
          <string>4f9678ab-87e1-4652-8055-d54decec2aa1</string>
          <string>a5f0676c-781d-4a84-8c1c-c27af8c0249e</string>
          <string>e170cdc0-022b-4160-b259-ded4776d4258</string>
          <string>573409bb-9ea8-4ae7-b62d-c35782fd75b5</string>
          <string>2c51c1c0-40bb-47f3-a880-9f0dcbd94f50</string>
          <string>9fe21897-a6ea-440d-974f-91d7b3c5f863</string>
          <string>a3adc191-76bc-4623-b675-627c052b1e9c</string>
          <string>c36331d6-959d-430f-a502-437161f1fbab</string>
          <string>67d912c4-47a5-42ba-be12-dd77ff24dec9</string>
          <string>4c783b83-4620-4d9f-9d0d-ab68ad92a4fa</string>
          <string>0db27dec-a4ae-44ab-a03d-e278f25eb894</string>
          <string>881a6aef-8f85-4a61-b07e-47f556a91655</string>
          <string>32d53741-d577-411d-bbc5-eae8a0af9050</string>
          <string>7c826555-a4e8-46e5-b749-1e099eefb742</string>
          <string>1661c73e-47d5-42ba-9671-1b8398dba2b3</string>
          <string>6330fdcb-ab53-4ab3-bdc4-13d6cba4dbcd</string>
          <string>dfd034fa-bbcd-4bc7-bea5-22311d02c195</string>
          <string>47f25c2b-b347-4c08-8202-2b7f49eff283</string>
          <string>56d576ed-9a33-4efe-b200-30d10b1e5b5d</string>
        </disabledChannelIds>
        <codeTemplates>
          <codeTemplate version="4.5.2">
            <id>429d7026-7867-465f-ab2e-2a45aee9be73</id>
            <name>cens.cl.fhir.builders.AllergyIntolerance</name>
            <revision>2</revision>
            <lastModified>
              <time>1768650124860</time>
              <timezone>Etc/UTC</timezone>
            </lastModified>
            <contextSet>
              <delegate>
                <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                <contextType>SOURCE_RECEIVER</contextType>
                <contextType>DESTINATION_DISPATCHER</contextType>
              </delegate>
            </contextSet>
            <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
              <type>FUNCTION</type>
              <code>/**
 * AllergyIntoleranceResource (FHIR R4)
 * Builder para crear recursos AllergyIntolerance.
 *
 * Ejemplo:
 * var alg = new AllergyIntoleranceResource()
 *   .setId(&quot;alg-1&quot;)
 *   .setClinicalStatus(&quot;active&quot;)
 *   .setVerificationStatus(&quot;confirmed&quot;)
 *   .setType(&quot;allergy&quot;)                 // allergy | intolerance
 *   .setCategory([&quot;medication&quot;])        // food | medication | environment | biologic
 *   .setCriticality(&quot;high&quot;)             // low | high | unable-to-assess
 *   .setCode(&quot;7982&quot;, &quot;Penicillin&quot;, &quot;http://snomed.info/sct&quot;)
 *   .setPatient(&quot;Patient/123&quot;)
 *   .setRecordedDate(&quot;2026-01-17T12:00:00-03:00&quot;)
 *   .addReaction(&quot;247472004&quot;, &quot;Hives&quot;, &quot;http://snomed.info/sct&quot;, &quot;moderate&quot;)
 *   .build();
 */
function AllergyIntoleranceResource(object) {
  this.allergy = {
    resourceType: &quot;AllergyIntolerance&quot;
  };

  return this;
}

/**
 * id lógico
 * @param {String|Number} value
 * @returns {AllergyIntoleranceResource}
 */
AllergyIntoleranceResource.prototype.setId = function(value) {
  this.allergy.id = String(value);
  return this;
};

/**
 * clinicalStatus (CodeableConcept)
 * active | inactive | resolved
 * @param {String} code
 * @returns {AllergyIntoleranceResource}
 */
AllergyIntoleranceResource.prototype.setClinicalStatus = function(code) {
  this.allergy.clinicalStatus = {
    coding: [{
      system: &quot;http://terminology.hl7.org/CodeSystem/allergyintolerance-clinical&quot;,
      code: String(code)
    }]
  };
  return this;
};

/**
 * verificationStatus (CodeableConcept)
 * unconfirmed | confirmed | refuted | entered-in-error
 * @param {String} code
 * @returns {AllergyIntoleranceResource}
 */
AllergyIntoleranceResource.prototype.setVerificationStatus = function(code) {
  this.allergy.verificationStatus = {
    coding: [{
      system: &quot;http://terminology.hl7.org/CodeSystem/allergyintolerance-verification&quot;,
      code: String(code)
    }]
  };
  return this;
};

/**
 * type
 * allergy | intolerance
 * @param {String} value
 * @returns {AllergyIntoleranceResource}
 */
AllergyIntoleranceResource.prototype.setType = function(value) {
  this.allergy.type = String(value);
  return this;
};

/**
 * category (array)
 * food | medication | environment | biologic
 * @param {Array} values
 * @returns {AllergyIntoleranceResource}
 */
AllergyIntoleranceResource.prototype.setCategory = function(values) {
  // defensivo: siempre array
  this.allergy.category = (values &amp;&amp; values.length) ? values : [];
  return this;
};

/**
 * criticality
 * low | high | unable-to-assess
 * @param {String} value
 * @returns {AllergyIntoleranceResource}
 */
AllergyIntoleranceResource.prototype.setCriticality = function(value) {
  this.allergy.criticality = String(value);
  return this;
};

/**
 * code (CodeableConcept)
 * @param {String} code
 * @param {String} display
 * @param {String} system
 * @returns {AllergyIntoleranceResource}
 */
AllergyIntoleranceResource.prototype.setCode = function(code, display, system) {
  this.allergy.code = {
    coding: [{
      system: String(system),
      code: String(code),
      display: display
    }]
  };
  return this;
};

/**
 * patient reference (R4 usa &quot;patient&quot;; en R5 es &quot;patient&quot; también, pero ojo con otros cambios)
 * @param {String} reference - ej &quot;Patient/123&quot;
 * @returns {AllergyIntoleranceResource}
 */
AllergyIntoleranceResource.prototype.setPatient = function(reference) {
  this.allergy.patient = { reference: String(reference) };
  return this;
};

/**
 * recordedDate (FHIR dateTime ISO 8601)
 * @param {String} value - ej &quot;2026-01-17T12:00:00-03:00&quot;
 * @returns {AllergyIntoleranceResource}
 */
AllergyIntoleranceResource.prototype.setRecordedDate = function(value) {
  this.allergy.recordedDate = String(value);
  return this;
};

/**
 * recorder reference
 * @param {String} reference - ej &quot;Practitioner/45&quot;
 * @returns {AllergyIntoleranceResource}
 */
AllergyIntoleranceResource.prototype.setRecorder = function(reference) {
  this.allergy.recorder = { reference: String(reference) };
  return this;
};

/**
 * asserter reference
 * @param {String} reference - ej &quot;Patient/123&quot; o &quot;RelatedPerson/1&quot; o &quot;Practitioner/45&quot;
 * @returns {AllergyIntoleranceResource}
 */
AllergyIntoleranceResource.prototype.setAsserter = function(reference) {
  this.allergy.asserter = { reference: String(reference) };
  return this;
};

/**
 * note[] (Annotation)
 * @param {String} text
 * @returns {AllergyIntoleranceResource}
 */
AllergyIntoleranceResource.prototype.addNote = function(text) {
  if (!this.allergy.note) this.allergy.note = [];
  this.allergy.note.push({ text: String(text) });
  return this;
};

/**
 * Agrega una reaction[]
 * severity: mild | moderate | severe
 *
 * @param {String} manifestationCode
 * @param {String} manifestationDisplay
 * @param {String} manifestationSystem
 * @param {String} [severity]
 * @param {String} [description]
 * @returns {AllergyIntoleranceResource}
 */
AllergyIntoleranceResource.prototype.addReaction = function(manifestationCode, manifestationDisplay, manifestationSystem, severity, description) {
  if (!this.allergy.reaction) this.allergy.reaction = [];

  var reaction = {
    manifestation: [{
      coding: [{
        system: String(manifestationSystem),
        code: String(manifestationCode),
        display: manifestationDisplay
      }]
    }]
  };

  if (severity) reaction.severity = String(severity);
  if (description) reaction.description = String(description);

  this.allergy.reaction.push(reaction);
  return this;
};

/**
 * build()
 * Limpieza mínima para no enviar campos vacíos.
 * @returns {Object} AllergyIntolerance (FHIR R4)
 */
AllergyIntoleranceResource.prototype.build = function() {
  if (this.allergy.id === &quot;&quot;) delete this.allergy.id;
  return this.allergy;
};
</code>
            </properties>
          </codeTemplate>
          <codeTemplate version="4.5.2">
            <id>fdca5572-9192-4b36-83fb-e2abccba20e8</id>
            <name>cens.cl.fhir.builders.Bundle</name>
            <revision>3</revision>
            <lastModified>
              <time>1768768073921</time>
              <timezone>Etc/UTC</timezone>
            </lastModified>
            <contextSet>
              <delegate>
                <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                <contextType>SOURCE_RECEIVER</contextType>
                <contextType>DESTINATION_DISPATCHER</contextType>
              </delegate>
            </contextSet>
            <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
              <type>FUNCTION</type>
              <code>/**
	* BundleResource (FHIR R4) - transaction bundle * * Recibe recursos JSON ya construidos (por tus
	Builders) y arma Bundle.type=&quot;transaction&quot;. * * Ejemplo: * var bundle = new BundleResource() *  
	.addCreate(patient)        // POST Patient *   .addCreate(condition)      // POST Condition *  
	.addUpdate(location)       // PUT Location/{id} (requiere id) *   .build(); * *
	channelMap.put(&quot;bundleJson&quot;, JSON.stringify(bundle));

	@param {Any} object - 
	@return {Any} 
*/
function BundleResource(object) {
  this.bundle = {
    resourceType: &quot;Bundle&quot;,
    type: &quot;transaction&quot;,
    entry: []
  };

  return this;
}

/**
 * Asigna id (opcional) del Bundle.
 * @param {String|Number} value
 * @returns {BundleResource}
 */
BundleResource.prototype.setId = function(value) {
  this.bundle.id = String(value);
  return this;
};

/**
 * Asigna timestamp ISO 8601 (opcional).
 * @param {String} value - ej: &quot;2026-01-17T12:00:00-03:00&quot;
 * @returns {BundleResource}
 */
BundleResource.prototype.setTimestamp = function(value) {
  this.bundle.timestamp = String(value);
  return this;
};

/**
 * Agrega una entry genérica.
 *
 * @param {Object|String} resourceJson - Objeto JS del recurso o string JSON.
 * @param {String} method - &quot;POST&quot; | &quot;PUT&quot; | &quot;PATCH&quot; | &quot;DELETE&quot; (normalmente POST/PUT)
 * @param {String} [url] - request.url (ej: &quot;Patient&quot;, &quot;Patient/123&quot;). Si no va, se infiere.
 * @param {String} [fullUrl] - ej: &quot;urn:uuid:...&quot; o &quot;http://server/fhir/Patient/123&quot;
 * @returns {BundleResource}
 */
BundleResource.prototype.addEntry = function(resourceJson, method, url, fullUrl) {
  if (!this.bundle.entry) this.bundle.entry = [];

  // Acepta objeto o string JSON
  var resource = resourceJson;
  if (typeof resourceJson === &quot;string&quot;) {
    resource = JSON.parse(resourceJson);
  }

  if (!resource || !resource.resourceType) {
    throw &quot;addEntry: resourceJson debe tener resourceType&quot;;
  }

  var inferredUrl = url;
  if (!inferredUrl) {
    if (resource.id &amp;&amp; String(resource.id).length &gt; 0) {
      inferredUrl = resource.resourceType + &quot;/&quot; + String(resource.id);
    } else {
      inferredUrl = resource.resourceType; // create
    }
  }

  var entry = {
    resource: resource,
    request: {
      method: String(method),
      url: String(inferredUrl)
    }
  };

  if (fullUrl) entry.fullUrl = String(fullUrl);

  this.bundle.entry.push(entry);
  return this;
};

/**
 * Helper: POST (create). Si pasas url, lo usa; si no, usa resourceType.
 * @param {Object|String} resourceJson
 * @param {String} [url] - default: resourceType
 * @param {String} [fullUrl]
 * @returns {BundleResource}
 */
BundleResource.prototype.addCreate = function(resourceJson, url, fullUrl) {
  // Para POST, url debería ser &quot;ResourceType&quot; (sin /id)
  var resource = (typeof resourceJson === &quot;string&quot;) ? JSON.parse(resourceJson) : resourceJson;
  var finalUrl = url ? url : resource.resourceType;
  return this.addEntry(resource, &quot;POST&quot;, finalUrl, fullUrl);
};

/**
 * Helper: PUT (update) usando ResourceType/{id}. Requiere id.
 * @param {Object|String} resourceJson
 * @param {String} [fullUrl]
 * @returns {BundleResource}
 */
BundleResource.prototype.addUpdate = function(resourceJson, fullUrl) {
  var resource = (typeof resourceJson === &quot;string&quot;) ? JSON.parse(resourceJson) : resourceJson;

  if (!resource.id || String(resource.id).length === 0) {
    throw &quot;addUpdate: el recurso debe tener id para PUT&quot;;
  }

  var finalUrl = resource.resourceType + &quot;/&quot; + String(resource.id);
  return this.addEntry(resource, &quot;PUT&quot;, finalUrl, fullUrl);
};

/**
 * Helper: PUT explícito a un url específico (útil si quieres condicionar el endpoint).
 * @param {Object|String} resourceJson
 * @param {String} url - ej: &quot;Patient/123&quot;
 * @param {String} [fullUrl]
 * @returns {BundleResource}
 */
BundleResource.prototype.addPut = function(resourceJson, url, fullUrl) {
  return this.addEntry(resourceJson, &quot;PUT&quot;, url, fullUrl);
};

/**
 * Helper: POST explícito a un url específico (normalmente &quot;ResourceType&quot;).
 * @param {Object|String} resourceJson
 * @param {String} url - ej: &quot;Patient&quot;
 * @param {String} [fullUrl]
 * @returns {BundleResource}
 */
BundleResource.prototype.addPost = function(resourceJson, url, fullUrl) {
  return this.addEntry(resourceJson, &quot;POST&quot;, url, fullUrl);
};

/**
 * Devuelve el Bundle construido.
 * @returns {Object} Bundle transaction (FHIR R4)
 */
BundleResource.prototype.build = function() {
  // Limpieza mínima: si entry vacío, igual lo devolvemos (útil para debug)
  return this.bundle;
};</code>
            </properties>
          </codeTemplate>
          <codeTemplate version="4.5.2">
            <id>b7082d2e-f319-4d70-bd4d-a32bef1ec385</id>
            <name>cens.cl.fhir.builders.Condition</name>
            <revision>4</revision>
            <lastModified>
              <time>1768768074331</time>
              <timezone>Etc/UTC</timezone>
            </lastModified>
            <contextSet>
              <delegate>
                <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                <contextType>SOURCE_RECEIVER</contextType>
                <contextType>DESTINATION_DISPATCHER</contextType>
              </delegate>
            </contextSet>
            <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
              <type>FUNCTION</type>
              <code>/**
	* ConditionResource (FHIR R4) * Builder para crear recursos Condition. * * Ejemplo: * var condition
	= new ConditionResource() *   .setId(&quot;cond-1&quot;) *   .setClinicalStatus(&quot;active&quot;) *  
	.setVerificationStatus(&quot;confirmed&quot;) *   .setCategory(&quot;problem-list-item&quot;, &quot;Problem List&quot;) *  
	.setCode(&quot;I10&quot;, &quot;Hypertension&quot;, &quot;http://hl7.org/fhir/sid/icd-10&quot;) *   .setSubject(&quot;Patient/123&quot;) *  
	.setOnsetDate(&quot;2024-01-01&quot;) *   .setRecorder(&quot;Practitioner/45&quot;) *   .build();

	@param {Any} object - 
	@return {Any} 
*/
function ConditionResource(object) {

  this.condition = {
    resourceType: &quot;Condition&quot;
  };

  return this;
}

/**
 * Asigna id lógico
 * @param {String|Number} value
 * @returns {ConditionResource}
 */
ConditionResource.prototype.setId = function(value) {
  this.condition.id = String(value);
  return this;
};

/**
 * clinicalStatus (CodeableConcept)
 * active | recurrence | remission | resolved
 */
ConditionResource.prototype.setClinicalStatus = function(code) {

  this.condition.clinicalStatus = {
    coding: [{
      system: &quot;http://terminology.hl7.org/CodeSystem/condition-clinical&quot;,
      code: String(code)
    }]
  };
  return this;
};

/**
 * verificationStatus
 * unconfirmed | provisional | differential | confirmed | refuted | entered-in-error
 */
ConditionResource.prototype.setVerificationStatus = function(code) {

  this.condition.verificationStatus = {
    coding: [{
      system: &quot;http://terminology.hl7.org/CodeSystem/condition-ver-status&quot;,
      code: String(code)
    }]
  };
  return this;
};

/**
 * category (CodeableConcept[])
 */
ConditionResource.prototype.setCategory = function(code, display) {

  if (!this.condition.category)
    this.condition.category = [];

  this.condition.category.push({
    coding: [{
      system: &quot;http://terminology.hl7.org/CodeSystem/condition-category&quot;,
      code: String(code),
      display: display
    }]
  });

  return this;
};

/**
 * code (diagnóstico)
 */
ConditionResource.prototype.setCode = function(code, display, system) {

  this.condition.code = {
    coding: [{
      system: String(system),
      code: String(code),
      display: display
    }]
  };
  return this;
};

/**
 * subject
 */
ConditionResource.prototype.setSubject = function(reference) {

  this.condition.subject = {
    reference: String(reference)
  };
  return this;
};

/**
 * onsetDateTime
 */
ConditionResource.prototype.setOnsetDate = function(date) {

  this.condition.onsetDateTime = String(date);
  return this;
};

/**
 * recorder
 */
ConditionResource.prototype.setRecorder = function(reference) {

  this.condition.recorder = {
    reference: String(reference)
  };
  return this;
};

/**
 * asserter
 */
ConditionResource.prototype.setAsserter = function(reference) {

  this.condition.asserter = {
    reference: String(reference)
  };
  return this;
};

/**
 * severity
 */
ConditionResource.prototype.setSeverity = function(code, display, system) {

  this.condition.severity = {
    coding: [{
      system: String(system),
      code: String(code),
      display: display
    }]
  };
  return this;
};

/**
 * note[]
 */
ConditionResource.prototype.addNote = function(text) {

  if (!this.condition.note)
    this.condition.note = [];

  this.condition.note.push({
    text: String(text)
  });
  return this;
};

/**
 * Retorna el Condition construido
 */
ConditionResource.prototype.build = function() {

  if (this.condition.id === &quot;&quot;) delete this.condition.id;
  return this.condition;
};</code>
            </properties>
          </codeTemplate>
          <codeTemplate version="4.5.2">
            <id>47d67e3e-df28-4f2c-a6b0-98d505246c55</id>
            <name>cens.cl.fhir.builders.Encounter</name>
            <revision>1</revision>
            <lastModified>
              <time>1768604058673</time>
              <timezone>Etc/UTC</timezone>
            </lastModified>
            <contextSet>
              <delegate>
                <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                <contextType>SOURCE_RECEIVER</contextType>
                <contextType>DESTINATION_DISPATCHER</contextType>
              </delegate>
            </contextSet>
            <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
              <type>FUNCTION</type>
              <code>/**
	Modify the description here. Modify the function name and parameters as needed. One function per
	template is recommended; create a new code template for each new function.

	@param {String} arg1 - arg1 description
	@return {String} return description
*/
function new_function1(arg1) {
	// TODO: Enter code here
}</code>
            </properties>
          </codeTemplate>
          <codeTemplate version="4.5.2">
            <id>029481be-ba87-4081-aa6e-dd18804c3860</id>
            <name>cens.cl.fhir.builders.Location</name>
            <revision>3</revision>
            <lastModified>
              <time>1768768074461</time>
              <timezone>Etc/UTC</timezone>
            </lastModified>
            <contextSet>
              <delegate>
                <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                <contextType>SOURCE_RECEIVER</contextType>
                <contextType>DESTINATION_DISPATCHER</contextType>
              </delegate>
            </contextSet>
            <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
              <type>FUNCTION</type>
              <code>/**
	* LocationResource (FHIR R4) * Builder para crear recursos Location. * * Ejemplo: * var loc = new
	LocationResource() *   .setId(&quot;loc-1&quot;) *   .setStatus(&quot;active&quot;) *   .setName(&quot;Centro Médico ABC -
	Box 3&quot;) *   .setDescription(&quot;Box de medicina general&quot;) *   .setMode(&quot;instance&quot;) *  
	.setType(&quot;PHARM&quot;, &quot;Pharmacy&quot;, &quot;http://terminology.hl7.org/CodeSystem/v3-RoleCode&quot;) *  
	.setAddress([&quot;Av. Siempre Viva 742&quot;], &quot;Santiago&quot;, &quot;RM&quot;, &quot;8320000&quot;, &quot;CL&quot;) *   .setPosition(-33.4489,
	-70.6693, 560) *   .setManagingOrganization(&quot;Organization/1&quot;) *   .build();

	@param {Any} object - 
	@return {Any} 
*/
function LocationResource(object) {
  this.location = {
    resourceType: &quot;Location&quot;
  };

  return this;
}

/**
 * Asigna id lógico
 * @param {String|Number} value
 * @returns {LocationResource}
 */
LocationResource.prototype.setId = function(value) {
  this.location.id = String(value);
  return this;
};

/**
 * status: active | suspended | inactive
 * @param {String} value
 * @returns {LocationResource}
 */
LocationResource.prototype.setStatus = function(value) {
  this.location.status = String(value);
  return this;
};

/**
 * name
 * @param {String} value
 * @returns {LocationResource}
 */
LocationResource.prototype.setName = function(value) {
  this.location.name = String(value);
  return this;
};

/**
 * description
 * @param {String} value
 * @returns {LocationResource}
 */
LocationResource.prototype.setDescription = function(value) {
  this.location.description = String(value);
  return this;
};

/**
 * mode: instance | kind
 * @param {String} value
 * @returns {LocationResource}
 */
LocationResource.prototype.setMode = function(value) {
  this.location.mode = String(value);
  return this;
};

/**
 * type: CodeableConcept[]
 * @param {String} code
 * @param {String} display
 * @param {String} system
 * @returns {LocationResource}
 */
LocationResource.prototype.setType = function(code, display, system) {
  if (!this.location.type) this.location.type = [];

  this.location.type.push({
    coding: [{
      system: String(system),
      code: String(code),
      display: display
    }]
  });

  return this;
};

/**
 * physicalType: CodeableConcept (opcional)
 * Ejemplos HL7 v3: bu (Building), ro (Room), wa (Ward), bd (Bed)
 * @param {String} code
 * @param {String} display
 * @param {String} system - ej: http://terminology.hl7.org/CodeSystem/location-physical-type
 * @returns {LocationResource}
 */
LocationResource.prototype.setPhysicalType = function(code, display, system) {
  this.location.physicalType = {
    coding: [{
      system: String(system),
      code: String(code),
      display: display
    }]
  };
  return this;
};

/**
 * address (FHIR Address)
 * @param {Array} lineArray
 * @param {String} city
 * @param {String} state
 * @param {String} postalCode
 * @param {String} country (ISO2, ej &quot;CL&quot;)
 * @returns {LocationResource}
 */
LocationResource.prototype.setAddress = function(lineArray, city, state, postalCode, country) {
  this.location.address = {
    line: (lineArray &amp;&amp; lineArray.length) ? lineArray : []
  };
  if (city) this.location.address.city = String(city);
  if (state) this.location.address.state = String(state);
  if (postalCode) this.location.address.postalCode = String(postalCode);
  if (country) this.location.address.country = String(country);

  return this;
};

/**
 * position (lat/long/alt) - decimales
 * @param {Number} latitude
 * @param {Number} longitude
 * @param {Number} [altitude]
 * @returns {LocationResource}
 */
LocationResource.prototype.setPosition = function(latitude, longitude, altitude) {
  this.location.position = {
    latitude: Number(latitude),
    longitude: Number(longitude)
  };
  if (altitude !== undefined &amp;&amp; altitude !== null) {
    this.location.position.altitude = Number(altitude);
  }
  return this;
};

/**
 * managingOrganization reference
 * @param {String} reference - ej &quot;Organization/1&quot;
 * @returns {LocationResource}
 */
LocationResource.prototype.setManagingOrganization = function(reference) {
  this.location.managingOrganization = { reference: String(reference) };
  return this;
};

/**
 * partOf reference (jerarquía de ubicaciones)
 * @param {String} reference - ej &quot;Location/parent&quot;
 * @returns {LocationResource}
 */
LocationResource.prototype.setPartOf = function(reference) {
  this.location.partOf = { reference: String(reference) };
  return this;
};

/**
 * telecom[] (ContactPoint)
 * @param {String} system - phone|fax|email|pager|url|sms|other
 * @param {String} value
 * @param {String} [use] - home|work|temp|old|mobile
 * @param {Number} [rank]
 * @returns {LocationResource}
 */
LocationResource.prototype.addTelecom = function(system, value, use, rank) {
  if (!this.location.telecom) this.location.telecom = [];

  var telecom = { system: String(system), value: String(value) };
  if (use) telecom.use = String(use);
  if (rank !== undefined &amp;&amp; rank !== null) telecom.rank = Number(rank);

  this.location.telecom.push(telecom);
  return this;
};

/**
 * identifier[] (FHIR Identifier)
 * @param {String} system
 * @param {String} value
 * @param {String} [use] - usual|official|temp|secondary|old
 * @returns {LocationResource}
 */
LocationResource.prototype.addIdentifier = function(system, value, use) {
  if (!this.location.identifier) this.location.identifier = [];

  this.location.identifier.push({
    use: use ? String(use) : &quot;official&quot;,
    system: String(system),
    value: String(value)
  });

  return this;
};

/**
 * Retorna el Location construido (limpieza mínima)
 * @returns {Object} Location (FHIR R4)
 */
LocationResource.prototype.build = function() {
  if (this.location.id === &quot;&quot;) delete this.location.id;
  return this.location;
};</code>
            </properties>
          </codeTemplate>
          <codeTemplate version="4.5.2">
            <id>a547df6c-15bc-4f98-bc31-3b94586921ff</id>
            <name>cens.cl.fhir.builders.Patient</name>
            <revision>16</revision>
            <lastModified>
              <time>1768768074579</time>
              <timezone>Etc/UTC</timezone>
            </lastModified>
            <contextSet>
              <delegate>
                <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                <contextType>SOURCE_RECEIVER</contextType>
              </delegate>
            </contextSet>
            <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
              <type>FUNCTION</type>
              <code>/**
	* PatientResource (FHIR R4) - Mirth 4.5.2 / Rhino * * Ejemplo: * var patient = new PatientResource()
	*   .setId(&quot;123&quot;) *   .setActive(true) *   .addIdentifier(&quot;http://hospital.cl/mrn&quot;, &quot;MR&quot;, &quot;ABC-001&quot;,
	&quot;official&quot;) *   .addName(&quot;Pérez&quot;, [&quot;Juan&quot;], &quot;official&quot;) *   .setGender(&quot;male&quot;) *  
	.setBirthDate(&quot;1990-01-31&quot;) *   .addTelecom(&quot;phone&quot;, &quot;+56911112222&quot;, &quot;mobile&quot;, 1) *  
	.addAddress([&quot;Av. Siempre Viva 742&quot;], &quot;Santiago&quot;, &quot;RM&quot;, &quot;8320000&quot;, &quot;CL&quot;, &quot;home&quot;, &quot;both&quot;) *  
	.build();

	@param {Any} object - 
	@return {Any} 
*/
function PatientResource(object) {
  this.patient = {
    resourceType: &quot;Patient&quot;,
    active: true,
    identifier: [],
    name: [],
    telecom: [],
    address: []
  };

  return this;
}

/**
 * Asigna el id lógico del Patient.
 * @param {String|Number} value
 * @returns {PatientResource}
 */
PatientResource.prototype.setId = function(value) {
  this.patient.id = String(value);
  return this;
};

/**
 * Asigna active.
 * @param {Boolean} value
 * @returns {PatientResource}
 */
PatientResource.prototype.setActive = function(value) {
  this.patient.active = (value === true);
  return this;
};

/**
 * Agrega un Identifier.
 * @param {String} system - URI/OID (ej: &quot;http://hospital.cl/mrn&quot; o &quot;urn:oid:...&quot;)
 * @param {String} typeCode - v2-0203 (ej: &quot;MR&quot;, &quot;PPN&quot;). Si no aplica, null.
 * @param {String} value - valor del identificador
 * @param {String} [use] - usual|official|temp|secondary|old
 * @returns {PatientResource}
 */
PatientResource.prototype.addIdentifier = function(system, typeCode, value, use) {
  // Defensa anti-Mirth: asegura el array
  if (!this.patient) {
    this.patient = { resourceType: &quot;Patient&quot; };
  }
  if (!this.patient.identifier) {
    this.patient.identifier = [];
  }

  var id = {
    use: use ? String(use) : &quot;official&quot;,
    system: String(system),
    value: String(value)
  };

  if (typeCode) {
    id.type = {
      coding: [{
        system: &quot;http://terminology.hl7.org/CodeSystem/v2-0203&quot;,
        code: String(typeCode)
      }]
    };
  }

  this.patient.identifier.push(id);
  return this;
};


/**
 * Agrega un HumanName.
 * @param {String} family
 * @param {Array} givenArray
 * @param {String} [use] - official|usual|temp|nickname|anonymous|old|maiden
 * @returns {PatientResource}
 */
PatientResource.prototype.addName = function(family, givenArray, use) {
  if (!this.patient) this.patient = { resourceType: &quot;Patient&quot; };
  if (!this.patient.name) this.patient.name = [];

  var name = {
    use: use ? String(use) : &quot;official&quot;,
    family: family ? String(family) : &quot;&quot;,
    given: (givenArray &amp;&amp; givenArray.length) ? givenArray : []
  };

  this.patient.name.push(name);
  return this;
};

/**
 * Asigna gender (FHIR).
 * @param {String} value - male|female|other|unknown
 * @returns {PatientBuilder}
 */
PatientResource.prototype.setGender = function(value) {
  this.patient.gender = String(value);
  return this;
};

/**
 * Asigna birthDate (FHIR date: YYYY-MM-DD).
 * @param {String} value
 * @returns {PatientResource}
 */
PatientResource.prototype.setBirthDate = function(value) {
  this.patient.birthDate = String(value);
  return this;
};

/**
 * Agrega telecom (ContactPoint).
 * @param {String} system - phone|fax|email|pager|url|sms|other
 * @param {String} value
 * @param {String} [use] - home|work|temp|old|mobile
 * @param {Number} [rank]
 * @returns {PatientResource}
 */
PatientResource.prototype.addTelecom = function(system, value, use, rank) {
  if (!this.patient) this.patient = { resourceType: &quot;Patient&quot; };
  if (!this.patient.telecom) this.patient.telecom = [];

  var telecom = { system: String(system), value: String(value) };
  if (use) telecom.use = String(use);
  if (rank !== undefined &amp;&amp; rank !== null) telecom.rank = Number(rank);

  this.patient.telecom.push(telecom);
  return this;
};

/**
 * Agrega una Address.
 * @param {Array} lineArray
 * @param {String} city
 * @param {String} state
 * @param {String} postalCode
 * @param {String} country - ISO2 (ej: CL)
 * @param {String} [use] - home|work|temp|old|billing
 * @param {String} [type] - postal|physical|both
 * @returns {PatientResource}
 */
PatientResource.prototype.addAddress = function(lineArray, city, state, postalCode, country, use, type) {
  if (!this.patient) this.patient = { resourceType: &quot;Patient&quot; };
  if (!this.patient.address) this.patient.address = [];

  var addr = { line: (lineArray &amp;&amp; lineArray.length) ? lineArray : [] };
  if (use) addr.use = String(use);
  if (type) addr.type = String(type);
  if (city) addr.city = String(city);
  if (state) addr.state = String(state);
  if (postalCode) addr.postalCode = String(postalCode);
  if (country) addr.country = String(country);

  this.patient.address.push(addr);
  return this;
};

/**
 * Agrega Patient.link
 * @param {String} otherReference - ej: &quot;Patient/999&quot;
 * @param {String} type - replaced-by|replaces|refer|seealso
 * @returns {PatientResource}
 */
PatientResource.prototype.addLink = function(otherReference, type) {
  if (!this.patient.link) this.patient.link = [];
  this.patient.link.push({
    other: { reference: String(otherReference) },
    type: String(type)
  });
  return this;
};

/**
 * Devuelve el Patient construido. (Limpia campos vacíos opcionales)
 * @returns {Object} Patient (FHIR R4)
 */
PatientResource.prototype.build = function() {
  // Limpieza: no mandes basura vacía al servidor.
  if (this.patient.id === &quot;&quot;) delete this.patient.id;
  if (this.patient.gender === &quot;&quot;) delete this.patient.gender;
  if (this.patient.birthDate === &quot;&quot;) delete this.patient.birthDate;

  // Si no agregaste nada, evita arrays vacíos opcionalmente (a gusto del integrador)
  if (this.patient.identifier &amp;&amp; this.patient.identifier.length === 0) delete this.patient.identifier;
  if (this.patient.name &amp;&amp; this.patient.name.length === 0) delete this.patient.name;
  if (this.patient.telecom &amp;&amp; this.patient.telecom.length === 0) delete this.patient.telecom;
  if (this.patient.address &amp;&amp; this.patient.address.length === 0) delete this.patient.address;

  return this.patient;
};</code>
            </properties>
          </codeTemplate>
          <codeTemplate version="4.5.2">
            <id>124f7e1c-7823-4c1f-91c1-a15fe701ff3d</id>
            <name>cens.cl.fhir.builders.Practitioner</name>
            <revision>3</revision>
            <lastModified>
              <time>1768768074676</time>
              <timezone>Etc/UTC</timezone>
            </lastModified>
            <contextSet>
              <delegate>
                <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                <contextType>SOURCE_RECEIVER</contextType>
                <contextType>DESTINATION_DISPATCHER</contextType>
              </delegate>
            </contextSet>
            <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
              <type>FUNCTION</type>
              <code>/**
	* PractitionerResource (FHIR R4) * Builder para crear recursos Practitioner. * * Ejemplo: * var prac
	= new PractitionerResource() *   .setId(&quot;prac-1&quot;) *   .setActive(true) *  
	.addIdentifier(&quot;http://minsal.cl/rnpi&quot;, &quot;MD&quot;, &quot;123456&quot;) // system, typeCode, value *  
	.addName(&quot;Pérez&quot;, [&quot;Ana&quot;, &quot;María&quot;], &quot;official&quot;, [&quot;Dra.&quot;]) *   .setGender(&quot;female&quot;) *  
	.setBirthDate(&quot;1985-04-10&quot;) *   .addTelecom(&quot;phone&quot;, &quot;+56911112222&quot;, &quot;mobile&quot;, 1) *  
	.addAddress([&quot;Calle 123&quot;], &quot;Santiago&quot;, &quot;RM&quot;, &quot;8320000&quot;, &quot;CL&quot;, &quot;work&quot;, &quot;both&quot;) *  
	.addQualification(&quot;MD&quot;, &quot;Médico Cirujano&quot;, &quot;http://terminology.hl7.org/CodeSystem/v2-0360&quot;) *  
	.addCommunication(&quot;es&quot;, &quot;Spanish&quot;) *   .build();

	@param {Any} object - 
	@return {Any} 
*/
function PractitionerResource(object) {
  this.practitioner = {
    resourceType: &quot;Practitioner&quot;,
    active: true
  };

  return this;
}

/**
 * id lógico
 * @param {String|Number} value
 * @returns {PractitionerResource}
 */
PractitionerResource.prototype.setId = function(value) {
  this.practitioner.id = String(value);
  return this;
};

/**
 * active
 * @param {Boolean} value
 * @returns {PractitionerResource}
 */
PractitionerResource.prototype.setActive = function(value) {
  this.practitioner.active = (value === true);
  return this;
};

/**
 * identifier[]
 * @param {String} system
 * @param {String} typeCode - v2-0203 (ej: &quot;MD&quot;, &quot;MR&quot;, etc.) opcional
 * @param {String} value
 * @param {String} [use]
 * @returns {PractitionerResource}
 */
PractitionerResource.prototype.addIdentifier = function(system, typeCode, value, use) {
  if (!this.practitioner.identifier) this.practitioner.identifier = [];

  var id = {
    use: use ? String(use) : &quot;official&quot;,
    system: String(system),
    value: String(value)
  };

  if (typeCode) {
    id.type = {
      coding: [{
        system: &quot;http://terminology.hl7.org/CodeSystem/v2-0203&quot;,
        code: String(typeCode)
      }]
    };
  }

  this.practitioner.identifier.push(id);
  return this;
};

/**
 * name[] (HumanName)
 * @param {String} family
 * @param {Array} givenArray
 * @param {String} [use]
 * @param {Array} [prefixArray]
 * @param {Array} [suffixArray]
 * @returns {PractitionerResource}
 */
PractitionerResource.prototype.addName = function(family, givenArray, use, prefixArray, suffixArray) {
  if (!this.practitioner.name) this.practitioner.name = [];

  var name = {
    use: use ? String(use) : &quot;official&quot;,
    family: family ? String(family) : &quot;&quot;,
    given: (givenArray &amp;&amp; givenArray.length) ? givenArray : []
  };

  if (prefixArray &amp;&amp; prefixArray.length) name.prefix = prefixArray;
  if (suffixArray &amp;&amp; suffixArray.length) name.suffix = suffixArray;

  this.practitioner.name.push(name);
  return this;
};

/**
 * gender (male|female|other|unknown)
 * @param {String} value
 * @returns {PractitionerResource}
 */
PractitionerResource.prototype.setGender = function(value) {
  this.practitioner.gender = String(value);
  return this;
};

/**
 * birthDate (YYYY-MM-DD)
 * @param {String} value
 * @returns {PractitionerResource}
 */
PractitionerResource.prototype.setBirthDate = function(value) {
  this.practitioner.birthDate = String(value);
  return this;
};

/**
 * telecom[] (ContactPoint)
 * @param {String} system - phone|fax|email|pager|url|sms|other
 * @param {String} value
 * @param {String} [use] - home|work|temp|old|mobile
 * @param {Number} [rank]
 * @returns {PractitionerResource}
 */
PractitionerResource.prototype.addTelecom = function(system, value, use, rank) {
  if (!this.practitioner.telecom) this.practitioner.telecom = [];

  var telecom = { system: String(system), value: String(value) };
  if (use) telecom.use = String(use);
  if (rank !== undefined &amp;&amp; rank !== null) telecom.rank = Number(rank);

  this.practitioner.telecom.push(telecom);
  return this;
};

/**
 * address[] (Address)
 * @param {Array} lineArray
 * @param {String} city
 * @param {String} state
 * @param {String} postalCode
 * @param {String} country
 * @param {String} [use] - home|work|temp|old|billing
 * @param {String} [type] - postal|physical|both
 * @returns {PractitionerResource}
 */
PractitionerResource.prototype.addAddress = function(lineArray, city, state, postalCode, country, use, type) {
  if (!this.practitioner.address) this.practitioner.address = [];

  var addr = { line: (lineArray &amp;&amp; lineArray.length) ? lineArray : [] };
  if (use) addr.use = String(use);
  if (type) addr.type = String(type);
  if (city) addr.city = String(city);
  if (state) addr.state = String(state);
  if (postalCode) addr.postalCode = String(postalCode);
  if (country) addr.country = String(country);

  this.practitioner.address.push(addr);
  return this;
};

/**
 * qualification[] (opcional pero útil)
 * @param {String} code
 * @param {String} display
 * @param {String} system
 * @returns {PractitionerResource}
 */
PractitionerResource.prototype.addQualification = function(code, display, system) {
  if (!this.practitioner.qualification) this.practitioner.qualification = [];

  this.practitioner.qualification.push({
    code: {
      coding: [{
        system: String(system),
        code: String(code),
        display: display
      }]
    }
  });

  return this;
};

/**
 * communication[] (CodeableConcept[])
 * En R4 Practitioner.communication existe.
 * @param {String} code - ej: &quot;es&quot;
 * @param {String} display - ej: &quot;Spanish&quot;
 * @param {String} [system] - default: IETF BCP 47
 * @returns {PractitionerResource}
 */
PractitionerResource.prototype.addCommunication = function(code, display, system) {
  if (!this.practitioner.communication) this.practitioner.communication = [];

  this.practitioner.communication.push({
    coding: [{
      system: system ? String(system) : &quot;urn:ietf:bcp:47&quot;,
      code: String(code),
      display: display
    }]
  });

  return this;
};

/**
 * photo[] (Attachment) - opcional
 * @param {String} contentType - ej: &quot;image/jpeg&quot;
 * @param {String} dataBase64 - contenido base64 (sin encabezados)
 * @returns {PractitionerResource}
 */
PractitionerResource.prototype.addPhoto = function(contentType, dataBase64) {
  if (!this.practitioner.photo) this.practitioner.photo = [];
  this.practitioner.photo.push({
    contentType: String(contentType),
    data: String(dataBase64)
  });
  return this;
};

/**
 * build()
 * @returns {Object} Practitioner (FHIR R4)
 */
PractitionerResource.prototype.build = function() {
  if (this.practitioner.id === &quot;&quot;) delete this.practitioner.id;

  // Limpieza: evita mandar strings vacíos si no se setearon
  if (this.practitioner.gender === &quot;&quot;) delete this.practitioner.gender;
  if (this.practitioner.birthDate === &quot;&quot;) delete this.practitioner.birthDate;

  return this.practitioner;
};</code>
            </properties>
          </codeTemplate>
          <codeTemplate version="4.5.2">
            <id>a6a9d87b-104b-42e5-aaa1-cc4f177bf2e4</id>
            <name>cens.cl.fhir.builders.ServiceRequest</name>
            <revision>11</revision>
            <lastModified>
              <time>1768768074778</time>
              <timezone>Etc/UTC</timezone>
            </lastModified>
            <contextSet>
              <delegate>
                <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
                <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                <contextType>SOURCE_RECEIVER</contextType>
                <contextType>DESTINATION_DISPATCHER</contextType>
              </delegate>
            </contextSet>
            <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
              <type>FUNCTION</type>
              <code>/**
	* Builder para crear recursos FHIR ServiceRequest * * USO: *
	------------------------------------------------- * var sr = new ServiceRequestResource() *  
	.setId(&quot;1&quot;) *   .setStatus(&quot;active&quot;) *   .setCategory(&quot;123&quot;,&quot;Consulta&quot;,&quot;http://category.cl&quot;) *  
	.setCode(&quot;456&quot;,&quot;Procedimiento&quot;,&quot;http://code.cl&quot;) *   .setSubject(&quot;Patient/123&quot;) *  
	.setEffectiveDateTime() *   .build(); * -------------------------------------------------

	@param {Any} object - 
	@return {Any} 
*/
function ServiceRequestResource(object) {
  /**
   * Objeto interno ServiceRequest
   * @type {Object}
   */
  this.serviceRequest = {
    resourceType: &quot;ServiceRequest&quot;
    //id: &quot;&quot;,
    //status: &quot;&quot;,
    //category: [],
    //code: {},
    //subject: {},
    //effectiveDateTime: &quot;&quot;
  };

  if (object.status == null) { throw &quot;status missed&quot; };
  this.serviceRequest.status = object.status;
  
  return this;
}

/**
 * Asigna el ID del recurso
 * @param {String|Number} value - Identificador del recurso
 * @returns {ServiceRequestResource} this (para chaining)
 */
ServiceRequestResource.prototype.setId = function(value) {
  this.serviceRequest.id = String(value);
  return this;
};

/**
 * Asigna el status del ServiceRequest
 * Valores válidos: draft | active | completed | revoked | entered-in-error | unknown
 *
 * @param {String} value - Estado del recurso
 * @returns {ServiceRequestResource}
 */
ServiceRequestResource.prototype.setStatus = function(value) {
  this.serviceRequest.status = value;
  return this;
};

/**
 * Asigna la categoría del ServiceRequest
 *
 * @param {String} code - Código de categoría
 * @param {String} display - Texto visible
 * @param {String} system - URI del sistema de códigos
 * @returns {ServiceRequestResource}
 */
ServiceRequestResource.prototype.setCategory = function(code, display, system) {

  this.serviceRequest.category = [{
    coding: [{
      code: code,
      display: display,
      system: system
    }]
  }];

  return this;
};

/**
 * Asigna el código clínico del ServiceRequest
 *
 * @param {String} code - Código clínico
 * @param {String} display - Descripción
 * @param {String} system - Sistema terminológico
 * @returns {ServiceRequestResource}
 */
ServiceRequestResource.prototype.setCode = function(code, display, system) {

  this.serviceRequest.code = {
    coding: [{
      code: code,
      display: display,
      system: system
    }]
  };

  return this;
};

/**
 * Asigna el sujeto (paciente)
 *
 * @param {String} reference - Referencia FHIR (ej: Patient/123)
 * @returns {ServiceRequestResource}
 */
ServiceRequestResource.prototype.setSubject = function(reference) {
  this.serviceRequest.subject = { reference: reference };
  return this;
};

/**
 * Asigna la fecha/hora actual en formato ISO 8601
 *
 * @returns {ServiceRequestResource}
 */
ServiceRequestResource.prototype.setEffectiveDateTime = function() {

  this.serviceRequest.effectiveDateTime = &quot;20260116&quot;
    //DateUtil.formatDate(new Date(), &quot;yyyy-MM-dd&apos;T&apos;HH:mm:ssXXX&quot;);

  return this;
};

/**
 * Retorna el ServiceRequest construido
 *
 * @returns {Object} Recurso FHIR ServiceRequest
 */
ServiceRequestResource.prototype.build = function() {
  return this.serviceRequest;
};</code>
            </properties>
          </codeTemplate>
        </codeTemplates>
      </codeTemplateLibrary>
    </codeTemplateLibraries>
  </exportData>
</channel>